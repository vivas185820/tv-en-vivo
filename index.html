<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV en Vivo VT</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:Arial}
#header{position:fixed;top:0;left:0;right:0;height:44px;background:#111;display:flex;align-items:center;justify-content:center}
#playerWrapper{position:fixed;top:44px;left:0;right:0;height:180px;background:#000}
#player{width:100%;height:100%;object-fit:contain}
#content{margin-top:235px;padding:10px}
input,button{width:100%;background:#1c1c1c;color:white;border:none;padding:8px;border-radius:6px;margin-bottom:8px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.channel{background:#1a1a1a;border-radius:6px;padding:6px;text-align:center}
.channel img{width:100%;height:60px;object-fit:contain}
.name{font-size:12px}
.fav{font-size:18px}
</style>
</head>

<body>

<div id="header">üì∫ TV en Vivo VT</div>

<div id="playerWrapper">
  <video id="player" controls playsinline></video>
</div>

<div id="content">

<input id="search" placeholder="Buscar canal...">
<button onclick="showFavorites()">‚≠ê Ver favoritos</button>

<div class="grid" id="list"></div>

</div>

<script>
const IPTV_URL = "https://raw.githubusercontent.com/iptv-org/iptv/master/languages/spa.m3u";

let channels = [];
let filtered = [];
let favorites = JSON.parse(localStorage.getItem("favs")||"[]");

fetch(IPTV_URL)
  .then(r=>r.text())
  .then(parseM3U);

function parseM3U(text){
  const lines=text.split("\n");
  for(let i=0;i<lines.length;i++){
    if(lines[i].startsWith("#EXTINF")){
      const name=lines[i].split(",")[1];
      const logo=(lines[i].match(/tvg-logo="(.*?)"/)||[])[1]||"https://via.placeholder.com/150x80?text=TV";
      const url=lines[i+1];
      const id=btoa(name+url);
      channels.push({id,name,logo,url});
    }
  }
  filtered=[...channels];
  render();
  play(0);
}

document.getElementById("search").oninput = e=>{
  const t=e.target.value.toLowerCase();
  filtered = channels.filter(c=>c.name.toLowerCase().includes(t));
  render();
};

function showFavorites(){
  filtered = channels.filter(c=>favorites.includes(c.id));
  render();
}

function render(){
  const box=document.getElementById("list");
  box.innerHTML="";
  filtered.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="channel";
    d.innerHTML=`
      <img src="${c.logo}">
      <div class="name">${c.name}</div>
      <div class="fav" onclick="event.stopPropagation();toggleFav('${c.id}')">
        ${favorites.includes(c.id)?"‚òÖ":"‚òÜ"}
      </div>
    `;
    d.onclick=()=>play(i);
    box.appendChild(d);
  });
}

function play(i){
  const v=document.getElementById("player");
  const url=filtered[i].url;
  if(Hls.isSupported()){
    const hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(v);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>v.play());
  }else{
    v.src=url;v.play();
  }
}

function toggleFav(id){
  if(favorites.includes(id)) favorites = favorites.filter(f=>f!==id);
  else favorites.push(id);
  localStorage.setItem("favs", JSON.stringify(favorites));
  render();
}
</script>

</body>
</html>