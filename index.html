<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>TV Live Plus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body { margin:0; background:#0b0b0b; color:white; font-family:Arial; }
header { background:#e50914; padding:10px; display:flex; justify-content:space-between; align-items:center; }
#controls { display:flex; gap:10px; }
button { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
#search { width:95%; margin:10px auto; padding:10px; border-radius:20px; border:none; }
#player { width:100%; height:260px; background:black; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; padding:10px; }
.card { background:#141414; padding:10px; border-radius:8px; cursor:pointer; text-align:center; }
.card:hover { background:#1f1f1f; }
</style>
</head>

<body>

<header>
  <div>üì∫ TV Live Plus</div>
  <div id="controls">
    <button onclick="prevChannel()">‚èÆ</button>
    <button onclick="nextChannel()">‚è≠</button>
  </div>
</header>

<div id="g_id_onload"
     data-client_id="YOUR_GOOGLE_CLIENT_ID"
     data-callback="handleCredentialResponse">
</div>
<div class="g_id_signin" data-type="standard"></div>

<input type="text" id="search" placeholder="üîç Buscar canal...">
<video id="player" controls autoplay></video>
<div class="grid" id="channels"></div>

<script>
const playlistURL = "https://iptv-org.github.io/iptv/index.m3u";
let allChannels = [];
let currentIndex = 0;

fetch(playlistURL)
.then(r => r.text())
.then(data => {
  const lines = data.split("\n");
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].startsWith("#EXTINF")) {
      allChannels.push({ name: lines[i].split(",")[1], url: lines[i+1] });
    }
  }
  render(allChannels);
  playIndex(0);
});

function render(list){
  const grid = document.getElementById("channels");
  grid.innerHTML = "";
  list.forEach((ch, i) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerText = ch.name;
    div.onclick = () => playIndex(i);
    grid.appendChild(div);
  });
}

function playIndex(i){
  currentIndex = i;
  const video = document.getElementById("player");
  const url = allChannels[i].url;

  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else {
    video.src = url;
    video.play();
  }
}

function nextChannel(){
  if(currentIndex < allChannels.length - 1) playIndex(currentIndex + 1);
}

function prevChannel(){
  if(currentIndex > 0) playIndex(currentIndex - 1);
}

document.getElementById("search").addEventListener("input", function(){
  const t = this.value.toLowerCase();
  const f = allChannels.filter(c => c.name.toLowerCase().includes(t));
  render(f);
});

// Google Login
function handleCredentialResponse(response) {
  const data = JSON.parse(atob(response.credential.split('.')[1]));
  alert("Bienvenido " + data.name);
}
</script>

</body>
</html>
